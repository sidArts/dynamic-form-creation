<!DOCTYPE html>
<html ng-app="app">
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="/css/font-awesome.css">
	<script type="text/javascript" src="/jquery.js"></script>
	<script type="text/javascript" src="/bootstrap.js"></script>
	<script type="text/javascript" src="/angular.js"></script>
</head>
<body ng-controller="appController">
<form name="navigation" method="post">	
	<input type="hidden" id="Authorization" name="token" value="<%=  token %>">
</form>
<nav class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">Logo</a>
    </div>
    <ul class="nav navbar-nav">
	    <li>
	    	<a href="#" ng-click="goto('createTemplate')">Create Template</a>
	    </li>
    	<li>
			<a href="#" ng-click="goto('myTemplates')">My Templates</a>
		</li>

    </ul>

    <ul class="nav navbar-nav navbar-right">
		<li><a href="#"><span class="fa fa-user"></span> Hello, </a></li>
		<li><a href="#"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a></li>
  	</ul>

  </div>
</nav>

<div class="container">
	<div class="row">
		<div class="col-lg-8 col-lg-offset-2">
			<table class="table table-striped" ng-init="getForms()">
				<thead>
					<tr>
						<th>#</th>
						<th>Title</th>
						<th>View Type</th>
						<th>Field Count</th>
						<!-- <th>ID</th> -->
						<th>Action</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="form in forms">
						<td>{{$index + 1}}</td>
						<td>{{form.title}}</td>
						<td>{{form.viewMode}}</td>
						<td>{{form.inputs.length}}</td>
						<!-- <td>{{form._id}}</td> -->
						<td>
							<button class="btn btn-primary btn-xs" ng-click="editForm(form._id)">
								<i class="fa fa-pencil"></i>
							</button>
							<button class="btn btn-danger btn-xs" ng-click="deleteForm(form._id)">
								<i class="fa fa-remove"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

<script type="text/javascript">
( function(){
	angular.module('app', [])
	.controller('appController', function($scope, $http){
		$scope.forms = [];
		$scope.goto = function(page){
			document.navigation.action = page;
			document.navigation.submit();
		};
		$scope.editForm = function(id){
			document.navigation.action = '/api/createTemplate';
			$(document.navigation).append($('<input>', { type: 'hidden', name: 'formId', value: id }));
			document.navigation.submit();
		};
		$scope.deleteForm = function(id){

			if(prompt('Are you sure want to delete?')) {
				document.navigation.action = '/api/deleteTemplate';
				document.navigation.formId.value = id;
				document.navigation.submit();	
			}
			
		};
		$scope.getForms = function() {
        	$http.get('/api/forms',{
            headers: {
              'x-access-token': document.navigation.token.value
            }
          	}).then(function(res){
        	 	console.log(res.data);
                $scope.forms = res.data;
        	}, function(err){
        	 	console.log(err);
        	});
    	};
	});
}());
</script>
</body>
</html>